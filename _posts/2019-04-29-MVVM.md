---
title: MVVM Cookbook
layout: post
---
<script src="//code.jquery.com/jquery.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/gist-embed/2.7.1/gist-embed.min.js"></script>


Credit: [fcamuso](https://www.youtube.com/playlist?list=PL0qAPtx8YtJe3WjjoRaB28ZGlX9heBqn3)

## [WPF & MVVM in C# ITA - 03: Hello World](https://youtu.be/QeC1jODur7o)

- Nest two stack panels for better layout control
- x: Refers to the xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" namespace
- mc:Ignorable="d" Specifies which XML namespace prefixes encountered in a markup file may be ignored by a XAML processor.
- Click property will add a button Click event in xaml.cs
- x:FiledModifier = "private" makes the fields private

<code data-gist-id="311d62164b6edac8b146affdb0940a30" data-gist-file="1-MainWindow.xaml" data-gist-hide-footer="true" data-gist-line="15-25"></code>

<code data-gist-id="311d62164b6edac8b146affdb0940a30" data-gist-file="1-MainWindow.xaml.cs" data-gist-hide-footer="true" data-gist-line="1-18"></code>

## [WPF & MVVM in C# ITA - 4: Data Service](https://youtu.be/q0InN1l6RzU)

- Remove Name text box and change Surname text box to combobox 
- Add a class (*Person*) and a (static) data source *PeopleService* defining a list of *Person*
- Combobox is linked to an abstract class (model) not to the data source directly -> easier to substitute the data source
- Create an instance of *PeopleService* and assign it to the comboBox.ItemSource
- Specify the property to be displayed using combobox.DisplayMemberPath
- In the Click event, cast the comboBox.SelectedItem to a *Person* object in order to access its properties (Name and Surname)

<code data-gist-id="311d62164b6edac8b146affdb0940a30" data-gist-file="2-MainWindow.xaml" data-gist-hide-footer="true"></code>

<code data-gist-id="311d62164b6edac8b146affdb0940a30" data-gist-file="2-MainWindow.xaml.cs" data-gist-hide-footer="true"></code>

<code data-gist-id="311d62164b6edac8b146affdb0940a30" data-gist-file="2-Person.cs" data-gist-hide-footer="true"></code>

<code data-gist-id="311d62164b6edac8b146affdb0940a30" data-gist-file="2-PeopleService.cs" data-gist-hide-footer="true"></code>

- To make our code independent from a class named *PeopleService* -> Make MainWindow independent from the Service used
- Add an interface to the PeopleService class

```csharp
    public interface IPeopleService
    {
        IList<Person> People { get; } //declare a read only property. 
        //Will be made available in the class implementing the interface
    }
```

- In the MainWindow change the field from *PeopleService* to *IPeopleService*
- Add a *IPeeopleService* parameter to the MainWindow constructor -> the Service will then be created outside the MainWindow class
 
 ```csharp
    private Models.IPeopleService peopleService = null; 

    public MainWindow(Models.IPeopleService _peopleService)
    {
        InitializeComponent();       
        peopleService = _peopleService;
        comboSurname.ItemsSource = peopleService.People;
        comboSurname.DisplayMemberPath = "Surname";
    }
 ```
 
 - MainWindow does not know the nature of the class we are passing, it only needs to respect the IPeopleService interface (does not have to look like something, but it has to behave like something)
 - The PeopleService class must be created in the App class
 
 ```csharp
    private void Application_Startup(object sender, StartupEventArgs e)
    {
        MainWindow mainWindow = new MainWindow(new Models.PeopleService());
        mainWindow.Show();
    }
```

- in the App.xaml, replace the StartupURI with

```csharp
Startup="Application_Startup">
```

- You can also remove the Startup property and change the code as:

```csharp
    protected override void OnStartup(StartupEventArgs e)
    {
        base.OnStartup(e);
        MainWindow mainWindow = new MainWindow(new Models.PeopleService());
        MainWindow.Show();
    }
```

## [WPF & MVVM in C# ITA - 5: Binding & ViewModel](https://youtu.be/dRdUXq8Q_t4)

### DataContext property
- Default source of your bindings 
- There's no default source for the DataContext property
- Inherited down through the control hierarchy
- Replaces the MainWindow IPersoneService property

```csharp
    public MainWindow(Models.IPeopleService _peopleService)
    {
        InitializeComponent();
        DataContext = _peopleService;
    }
```

In the MainWindow.xaml, add the binding to PeopleService.People and its property Surname:

```csharp
    <ComboBox x:Name="comboSurname" Width="120" Margin="8,0"
        ItemsSource="{Binding People}" DisplayMemberPath="Surname"/> 
```
            
- To make the best use of Data Binding let's create a class that connects the Model and the View -> MainWindowViewModel
- Model class -> Data Source (i.e. PeopleService)
- ViewModel class -> combines functions that connect Model class and View
- View -> xaml layout

Create a folder called ViewModels and a class called MainWindowViewModel.cs and copy the reference to the Service from the MainWindow.xaml.cs:

```csharp
public class MainWindowViewModel : INotifyPropertyChanged
    {
        private Models.IPeopleService _peopleService = null;
        
        public MainWindowViewModel(Models.IPeopleService peopleService)
        {
            _peopleService = peopleService;
        }
        
        public IList<Models.Person> People => _peopleService.People;
        //properties for binding
        public Models.Person ChosenPerson { get; set; } 
        private string _txtSaluto;
    }
```

Let's also move the method associated with the button Click:

```csharp
    public void SalutaMi()
    {
        if (ChosenPerson != null)
        {
            TextSaluto = String.Format("Ciao {0} {1}", ChosenPerson.Name, ChosenPerson.Surname);
        }
    }
``` 

Let's now isolate the MainWindow from the Service:

```csharp
    //public MainWindow(Models.IPeopleService peopleService)
    public MainWindow(ViewModels.MainWindowViewModel vm) //not great to link it to a specific ViewModel, can be made more generic
    {
        InitializeComponent();
        DataContext = vm;
    }
```

and bind the comboBox selected item and the text block Text to their respective properties in the MainWindowViewModel:

```csharp
  <ComboBox x:Name="comboSurname" Width="120" Margin="8,0"
       ItemsSource="{Binding People}" 
       DisplayMemberPath="Surname"
       SelectedItem="{Binding Path=ChosenPerson}"/>
  <TextBlock x:Name="tboxResult"
       x:FieldModifier="private"
       Text="{Binding Path = TextSaluto}"/>
```

then bind the click function in the xaml.cs:

```csharp
    private void BtnSalutami_Click(object sender, RoutedEventArgs e)
    {
        (DataContext as ViewModels.MainWindowViewModel).SalutaMi();
    }
```
and finally update the App.xaml.cs

```csharp
    protected override void OnStartup(StartupEventArgs e)
    {
        base.OnStartup(e);
        Models.PeopleService ps = new Models.PeopleService();
        MainWindow mainWindow = new MainWindow(new ViewModels.MainWindowViewModel(ps));
        mainWindow.Show();
    }
```
We could have imported the *HelloWpf.Models* and *HelloWpf.ViewModels* namespaces.

- If we run the code, the View does not know that the string txtSaluto has been updated -> we need to use INotifyPropertyChanged
    - Import the namespace *System.ComponentModel*