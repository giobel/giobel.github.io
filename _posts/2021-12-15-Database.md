---
title: 6. Databases
layout: post
date: 21/12/15
---

### Database

- can handle large amount of data efficiently
- provide tools to insert, query and update data
- they offer security features
- they can scale well
- SQL: Structured Query Language, relational databases. Use tables. MySQL, Postgres, SQLite
- NoSQL: store information in xml, yaml, json. No tables or schema to follow. MongoDB, Redis, Neo4j

### MongoDB

- mongo is commonly used with node and express
- easy to start and poular
- [installation](https://zarkom.net/blogs/how-to-install-mongodb-for-development-in-windows-3328)
- multiple databases at the same time
- create a new db `use dbName` (won't appear until there is data in it)
- BSON binary json, more compact in memory

### MongoDB CRUD operations
[Resource](https://docs.mongodb.com/manual/crud/)

#### Create

- insert data in collections `db.dogs.insertOne({name: "Charlie", age:3, breed:"corgie", isFriendly: true})`
- `db.dogs.insert([{name: "Walt", breed: "Golden", age: 14}, {name: "Tonya", breed:"Chihua", age:17}])`
- `show collections`
- `db.dogs.find()`

#### Find

- `db.dogs.find({breed: "corgi"})`

#### Updating

- `db.dogs.updateOne({name: "Charlie"}, {$set: {age: 15}})`

#### Deleting

- `db.dogs.deleteOne({name: "Charlie"})`
- `db.dogs.deleteMany({})`

#### Additional operators

- for nested properties: `db.dogs.find({'personality.childFriendly': true})`
- for multiple properties: `db.dogs.find({'personality.childFriendly': true, age: 10})`
- comparison, logical operators [etc](https://docs.mongodb.com/manual/reference/operator/query/) `db.dogs.find({ age: {$gt:20} })`
- in operator: the value of a field equals any value in the specified array `db.dogs.find({breed: {$in ['Mutt', 'Corgi']}})`
- or `db.dogs.find({$or: [{'personality.catfirendly': true}, {age: {$lte:2}}]})`

### Mongoose
[Resource](https://mongoosejs.com/)
- Connect node to MongoDB -> driver or Mongoose
- ODM: Object Data Mapper. Maps data from Mongo to JS objects
- ORM: same but for SQL data

Create a new folder and initialize npm 
`npm init -y`
Install mongoose 
`npm i mongoose`
Make an index.js 
`touch index.js`
Require mongoose
```js
const mongoose = require('mongoose');

main().catch(err => console.log(err));

async function main() {
  await mongoose.connect('mongodb://localhost:17017/movieApp');//movieApp is the database
  console.log('connection open!')
} 
```

Make a model (class) to interact with the database. 
1. Define a schema
```js
const movieSchema = new mongoose.Schema({
    title: String,
    year: Number,
    score: Number,
    rating: String
})
```
2. make a model from the schema
```js
const Movie = mongoose.model('Movie', movieSchema) //Movie should be uppercase and singular. mongoose will create a collection called movies
```
3. Create an instance of Movie
```js
const amad = new Movie({title: "Amad", year: 1986, score: 9.2, rating: 'R'});
```
4. Run node, load index.js from the project folder
```js
node
.load index.js
```
5. save it into mongodb
`amad.save();`

#### insert.Many()
```js
Movie.insertMany([
    {title: 'Amel', year:2001, score:8.3, rating:'R'},
    {title: 'The Iron', year:2004, score:3.3, rating:'R'},
])
.then(data => {
    console.log("it works")
    console.log(data)
})
```
No need to save into the db.